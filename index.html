<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="style1.css"/>
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=true&amp;libraries=places"></script>
    <script>
        console.log("hi");
        var map, locData, myLat, myLng, infoContent, me;
        var request = new XMLHttpRequest();
        var loc = new google.maps.LatLng(42.3581, -71.0636);
        var infowindow = new google.maps.InfoWindow({
        	content: infoContent,
        });
        var myOptions = {
                zoom: 12,
                center: loc,
                mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        function init(){
                map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);
                findMe();
                request.open("POST", "http://chickenofthesea.herokuapp.com/sendLocation", true);
                request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        }

        function dataReady(){
                if(request.readyState == 4 && request.status == 200){
                	console.log("tryna parse");
                        locData = JSON.parse(request.responseText);
                        updateMap(locData);
                }
        }

        function updateMap(locData){
        	var i = 0;
        	showMe();
                while(locData.characters[i] != undefined){
                	var tempMe, tempName, tempNote;
                        tempMe = new google.maps.LatLng(locData.characters[i].loc.latitude, locData.characters[i].loc.longitude);
                        tempName = locData.characters[i].name;
                        tempNote = locData.characters[i].loc.note;
                        console.log(tempName);
                        window["marker"+i] = new google.maps.Marker({
                                position: tempMe,
                                title: tempName,
                                icon: whichIcon(tempName),
                        });
                        window["marker"+i].setMap(map);
                        google.maps.event.addListener(window["marker"+i], 'click', function() {
	                       	window["info" + i] = new google.maps.InfoWindow({
        	               		content: tempNote,
                	       	});
				window["info" + i].open(map, window["marker"+i]);
			});
			console.log(myLat);
			var polyline = [
				tempMe,
				new google.maps.LatLng(myLat, myLng),
			];
                        window["poly"+i] = new google.maps.Polyline({
				path: polyline,
				geodesic: true,
				strokeColor: '#FF0000',
				strokeOpacity: 1.0,
				strokeWeight: 2
			});
			window["poly"+i].setMap(map);
                        i++;
                }
                for(j=0; j<100; j++){
                	var tempMe, tempName, tempNote;
                        tempMe = new google.maps.LatLng(locData.students[j].lat, locData.students[j].lng);
                        tempName = locData.students[j].login;
                        console.log(tempName);
                        window["student"+j] = new google.maps.Marker({
                                position: tempMe,
                                title: tempName,
                        });
                        window["student"+j].setMap(map);
                }
        }
        
        function whichIcon(name){
                if(name == "carmen")
                        return "http://tuftsdev.github.io/WebProgramming/images/carmen.png";
                if(name == "waldo")
                        return "http://tuftsdev.github.io/WebProgramming/images/waldo.png";
                if(name == "batman")
                        return "http://tuftsdev.github.io/WebProgramming/images/batman.png";
                if(name == "nr")
                        return "http://tuftsdev.github.io/WebProgramming/images/nr.png";
                if(name == "snape")
                        return "http://tuftsdev.github.io/WebProgramming/images/snape.png";
                if(name == "hescott")
                        return "http://tuftsdev.github.io/WebProgramming/images/hescott.png";
        }
        
        function showMe(){
                me = new google.maps.LatLng(myLat, myLng);
                marker = new google.maps.Marker({
                        position: me,
                        title: "me",
                        icon: "data:image/jpeg;base64,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"
               });
              marker.setMap(map);
        }

        function findMe(){
                if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(function(position) {
                                myLat = position.coords.latitude;
                                myLng = position.coords.longitude;
                                console.log(myLat);
                                request.send("login=AnthonyGoldstein&lat="+ myLat + "&lng=" + myLng);
                                console.log("chillin");
                                request.onreadystatechange = dataReady;
                        });
                }
                else {
                        alert("Geolocation is not supported by your web browser.  What a shame!");
                }
        }

        function addMarker(loc, trainId){
                marker = new google.maps.Marker({ position: loc, title: trainId});
                marker.setMap(map);
        }
    </script>
        </head>
  <body onload="init()">
<div id="map-canvas"></div>
  </body>
</html>

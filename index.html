<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" href="style1.css"/>
    <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=true&amp;libraries=places"></script>
    <script>
        console.log("hi");
        var map, locData, myLat, myLng, infoContent;
        var request = new XMLHttpRequest();
        var loc = new google.maps.LatLng(42.3581, -71.0636);
        var infowindow = new google.maps.InfoWindow({
        	content: infoContent,
        });
        var myOptions = {
                zoom: 12,
                center: loc,
                mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        function init(){
                map = new google.maps.Map(document.getElementById("map-canvas"), myOptions);
                findMe();
                request.open("POST", "http://chickenofthesea.herokuapp.com/sendLocation", true);
                request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        }

        function dataReady(){
                if(request.readyState == 4 && request.status == 200){
                	console.log("tryna parse");
                        locData = JSON.parse(request.responseText);
                        updateMap(locData);
                }
        }

        function updateMap(locData){
        	var i = 0;
        	showMe();
                while(locData.characters[i] != undefined){
                	var tempMe, tempName, tempNote;
                        tempMe = new google.maps.LatLng(locData.characters[i].loc.latitude, locData.characters[i].loc.longitude);
                        tempName = locData.characters[i].name;
                        tempNote = locData.characters[i].loc.note;
                        console.log(tempName);
                        window["marker"+i] = new google.maps.Marker({
                                position: tempMe,
                                title: tempName,
                                icon: whichIcon(tempName),
                        });
                        google.maps.event.addListener(window["marker"+i], 'click', function() {
//                        	window["info" + i] = new google.maps.InfoWindow({
//                        		content: tempNote,
//                        	});
//				window["info" + i].open(map, window["marker"+i]);
				infowindow.setContent(tempNote);
				infowindow.open(map, marker)
			});
                        window["marker"+i].setMap(map);
                        i++;
                }
        }
        
        function whichIcon(name){
                if(name == "carmen")
                        return "http://tuftsdev.github.io/WebProgramming/images/carmen.png";
                if(name == "waldo")
                        return "http://tuftsdev.github.io/WebProgramming/images/waldo.png";
                if(name == "batman")
                        return "http://tuftsdev.github.io/WebProgramming/images/batman.png";
                if(name == "nr")
                        return "http://tuftsdev.github.io/WebProgramming/images/nr.png";
                if(name == "snape")
                        return "http://tuftsdev.github.io/WebProgramming/images/snape.png";
                if(name == "hescott")
                        return "http://tuftsdev.github.io/WebProgramming/images/hescott.png";
        }
        
        function showMe(){
                me = new google.maps.LatLng(myLat, myLong);
                marker = new google.maps.Marker({
                        position: me,
                        title: "me",
               });
              marker.setMap(map);
        }

        function findMe(){
                if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(function(position) {
                                myLat = position.coords.latitude;
                                myLng = position.coords.longitude;
                                console.log(myLat);
                                request.send("login=AnthonyGoldstein&lat="+ myLat + "&lng=" + myLng);
                                console.log("chillin");
                                request.onreadystatechange = dataReady;
                        });
                }
                else {
                        alert("Geolocation is not supported by your web browser.  What a shame!");
                }
        }

        function addMarker(loc, trainId){
                marker = new google.maps.Marker({ position: loc, title: trainId});
                marker.setMap(map);
        }
    </script>
        </head>
  <body onload="init()">
<div id="map-canvas"></div>
  </body>
</html>
